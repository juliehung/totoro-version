cache:
    key: "$CI_PIPELINE_ID"
    paths:
        - .gradle/wrapper
        - .gradle/caches

stages:
    - package

before_script:
    - export GRADLE_USER_HOME=`pwd`/.gradle
    - chmod +x gradlew

testPackage:
    stage: package
    only:
        - merge_requests
    image: openjdk:8-jdk-stretch
    script:
        - apt-get install -y --no-install-recommends curl unzip
        - apt-get update && apt-get install -y --no-install-recommends --allow-unauthenticated gcc make libpng-dev
        - ./gradlew compileJava -x check --no-daemon
        - 'curl --location --output artifact.zip --header "PRIVATE-TOKEN: 2uhuvyyiXX2Kmz_RNAjE" "https://gitlab.com/api/v4/projects/8544858/jobs/artifacts/develop/download?job=buildArtifact"'
        - unzip artifact.zip -d build/resources/main/
        - ./gradlew bootWar -x check --no-daemon
    artifacts:
        paths:
            - build/*
